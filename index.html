<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>流域治水シナリオ AI – 利用者／管理者モック</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    .citation {
      font-size: 0.7rem;
      color: #93c5fd;
      margin-left: 0.2rem;
    }

    .refs-box {
      margin-top: 0.45rem;
      padding: 0.4rem 0.6rem;
      font-size: 0.68rem;
      color: #9ca3af;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.35);
      border-radius: 0.5rem;
    }

    .refs-title {
      font-weight: 600;
      font-size: 0.7rem;
      color: #cbd5e1;
      margin-bottom: 0.2rem;
    }

    .refs-list {
      padding-left: 1rem;
      margin: 0;
      line-height: 1.35;
    }


    :root {
      --bg: #050816;
      --card: #111827;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.08);
      --accent-border: rgba(56, 189, 248, 0.45);
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --radius-xl: 18px;
      --radius-2xl: 26px;
      --shadow-soft: 0 22px 45px rgba(0, 0, 0, 0.4);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top left, #1d243a 0, #050816 42%);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Top bar */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1.75rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.22);
      backdrop-filter: blur(14px);
      background: radial-gradient(circle at top left,
          rgba(56, 189, 248, 0.08),
          rgba(15, 23, 42, 0.96));
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: conic-gradient(from 160deg, #38bdf8, #22c55e, #6366f1, #38bdf8);
      position: relative;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.85);
    }

    .brand-logo::after {
      content: "";
      position: absolute;
      inset: 5px;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 25%, #f9fafb, #0f172a);
      mix-blend-mode: screen;
      opacity: 0.4;
    }

    .brand-title {
      display: flex;
      flex-direction: column;
      line-height: 1.2;
    }

    .brand-title span:first-child {
      font-size: 0.9rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent);
      font-weight: 600;
    }

    .brand-title span:last-child {
      font-size: 1rem;
      font-weight: 600;
      color: #f9fafb;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    /* Role toggle */
    .role-toggle {
      display: inline-flex;
      padding: 0.15rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .role-btn {
      border: none;
      background: transparent;
      color: var(--text-soft);
      padding: 0.25rem 0.9rem;
      border-radius: 999px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .role-btn.active {
      background: var(--accent);
      color: #020617;
      box-shadow: 0 10px 22px rgba(56, 189, 248, 0.5);
    }

    .badge {
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.78rem;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.9);
    }

    /* Layout */
    .app-shell {
      flex: 1;
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      gap: 1.5rem;
      padding: 1.25rem 1.75rem 1.5rem;
    }

    @media (max-width:900px) {
      .app-shell {
        grid-template-columns: 1fr;
        padding: 0.75rem;
      }
    }

    /* Sidebar */
    .sidebar {
      border-radius: var(--radius-2xl);
      background: linear-gradient(145deg, #020617, #020617 52%, #020617);
      border: 1px solid rgba(148, 163, 184, 0.32);
      box-shadow: var(--shadow-soft);
      padding: 1.1rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      position: relative;
      overflow: hidden;
    }

    .sidebar::before {
      content: "";
      position: absolute;
      inset: -120px;
      background: radial-gradient(circle at top,
          rgba(56, 189, 248, 0.13), transparent 52%);
      pointer-events: none;
    }

    .sidebar-header {
      position: relative;
      z-index: 1;
    }

    .sidebar-header h2 {
      margin: 0;
      font-size: 0.95rem;
    }

    .sidebar-header p {
      margin: 0.25rem 0 0;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .step-list {
      position: relative;
      z-index: 1;
      list-style: none;
      padding: 0;
      margin: 0.7rem 0 0;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .step-item {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      padding: 0.35rem 0.45rem;
      border-radius: 999px;
      cursor: pointer;
      border: 1px solid transparent;
      color: var(--text-soft);
      font-size: 0.78rem;
      transition: 0.18s ease-out;
    }

    .step-item:hover {
      background: rgba(31, 41, 55, 0.9);
      border-color: rgba(148, 163, 184, 0.6);
    }

    .step-item.active {
      background: var(--accent-soft);
      border-color: var(--accent-border);
      color: #e5f4ff;
      box-shadow: 0 0 0 1px rgba(2, 6, 23, 0.9),
        0 0 20px rgba(56, 189, 248, 0.38);
    }

    .step-index {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      background: rgba(15, 23, 42, 0.95);
      color: #cbd5f5;
    }

    .step-item.active .step-index {
      background: var(--accent);
      color: #020617;
      border-color: transparent;
    }

    .step-title {
      font-weight: 500;
    }

    .step-caption {
      font-size: 0.72rem;
      opacity: 0.9;
    }

    .sidebar-footer {
      position: relative;
      z-index: 1;
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-top: 0.85rem;
      padding: 0.6rem 0.55rem;
      border-radius: 0.9rem;
      background: rgba(15, 23, 42, 0.95);
      border: 1px dashed rgba(148, 163, 184, 0.45);
    }

    /* Main */
    .main {
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
      min-width: 0;
    }

    .main-header {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      justify-content: space-between;
      align-items: center;
    }

    .main-header-left h1 {
      margin: 0;
      font-size: 1.3rem;
      letter-spacing: 0.03em;
    }

    .main-header-left p {
      margin: 0.25rem 0 0;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.4rem;
    }

    .chip {
      font-size: 0.7rem;
      padding: 0.14rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
    }

    .btn {
      border-radius: 999px;
      border: none;
      cursor: pointer;
      padding: 0.42rem 0.9rem;
      font-size: 0.78rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: var(--accent);
      color: #020617;
      box-shadow: 0 14px 30px rgba(56, 189, 248, 0.45);
      transition: 0.1s ease-out;
    }

    .btn.secondary {
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: none;
    }

    .btn:hover {
      transform: translateY(-1px);
    }

    .btn.secondary:hover {
      box-shadow: 0 12px 26px rgba(15, 23, 42, 0.7);
    }

    .panel-container {
      flex: 1;
      border-radius: var(--radius-2xl);
      background: radial-gradient(circle at top left,
          rgba(56, 189, 248, 0.08), transparent 60%),
        linear-gradient(135deg, #020617, #020617 60%, #020617);
      border: 1px solid rgba(148, 163, 184, 0.34);
      box-shadow: var(--shadow-soft);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      min-height: 0;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .panel-header h2 {
      margin: 0;
      font-size: 0.98rem;
    }

    .panel-header p {
      margin: 0;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .panel {
      display: none;
      gap: 0.85rem;
      flex: 1;
      min-height: 0;
    }

    .panel.active {
      display: grid;
    }

    .two-col {
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
    }

    .single-col {
      grid-template-columns: minmax(0, 1fr);
    }

    @media (max-width:960px) {
      .two-col {
        grid-template-columns: 1fr;
      }
    }

    .card {
      border-radius: var(--radius-xl);
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 0.8rem 0.9rem;
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
      min-width: 0;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }

    .card-header h3 {
      margin: 0;
      font-size: 0.9rem;
    }

    .card-header span {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .card-body {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .upload-drop {
      border-radius: 1rem;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: radial-gradient(circle at top,
          rgba(148, 163, 184, 0.12), transparent 50%);
      padding: 1rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .file-list {
      margin-top: 0.55rem;
      border-radius: 0.8rem;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 0.4rem 0.55rem;
      max-height: 170px;
      overflow: auto;
      font-size: 0.76rem;
    }

    .file-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.25rem 0.1rem;
      border-bottom: 1px solid rgba(31, 41, 55, 0.95);
    }

    .file-row:last-child {
      border-bottom: none;
    }

    .file-name {
      color: #e5e7eb;
    }

    .file-meta {
      font-size: 0.72rem;
      color: var(--text-soft);
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.1rem 0.55rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.7rem;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.4);
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(30, 64, 175, 0.7);
      overflow: hidden;
      margin-top: 0.45rem;
    }

    .progress-bar-inner {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, #38bdf8, #22c55e);
      width: 72%;
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.7);
    }

    .log {
      margin-top: 0.55rem;
      font-family: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 0.8rem;
      padding: 0.5rem 0.6rem;
      border: 1px solid rgba(30, 64, 175, 0.95);
      max-height: 180px;
      overflow: auto;
      font-size: 0.72rem;
    }

    .log-line {
      display: flex;
      gap: 0.4rem;
      margin-bottom: 0.18rem;
      white-space: nowrap;
    }

    .log-time {
      color: #64748b;
    }

    .log-msg {
      color: #e5e7eb;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.25rem;
    }

    .pill {
      font-size: 0.7rem;
      padding: 0.12rem 0.4rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: rgba(15, 23, 42, 0.96);
    }

    .chat-window {
      border-radius: 1rem;
      padding: 0.55rem 0.7rem;
      background: radial-gradient(circle at top,
          rgba(59, 130, 246, 0.12), transparent 55%),
        rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(59, 130, 246, 0.75);
      max-height: 260px;
      overflow: auto;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .chat-window-large {
      border-radius: 1rem;
      padding: 0.55rem 0.7rem;
      background: radial-gradient(circle at top,
          rgba(59, 130, 246, 0.12), transparent 55%),
        rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(59, 130, 246, 0.75);
      max-height: 460px;
      overflow: auto;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .chat-message {
      max-width: 82%;
      padding: 0.32rem 0.5rem;
      border-radius: 0.8rem;
      font-size: 0.78rem;
      line-height: 1.35;
    }

    .chat-message.user {
      margin-left: auto;
      background: rgba(56, 189, 248, 0.24);
      border-bottom-right-radius: 0.1rem;
    }

    .chat-message.ai {
      margin-right: auto;
      background: rgba(15, 23, 42, 1);
      border: 1px solid rgba(148, 163, 184, 0.45);
      border-bottom-left-radius: 0.1rem;
    }

    .chat-meta {
      font-size: 0.67rem;
      color: var(--text-soft);
      margin-top: 0.06rem;
    }

    .chat-input-row {
      display: flex;
      gap: 0.4rem;
      margin-top: 0.4rem;
    }

    .chat-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      padding: 0.4rem 0.75rem;
      font-size: 0.78rem;
      background: rgba(15, 23, 42, 0.96);
      color: var(--text);
      outline: none;
    }

    .chat-input::placeholder {
      color: rgba(148, 163, 184, 0.75);
    }

    .doc-preview {
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: linear-gradient(135deg, #020617, #020617 62%, #020617);
      padding: 0.6rem 0.7rem;
      max-height: 260px;
      overflow: auto;
      font-size: 0.78rem;
    }

    .doc-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    .doc-title {
      font-weight: 600;
      font-size: 0.86rem;
    }

    .doc-tag {
      font-size: 0.7rem;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.12);
      color: #a7f3d0;
      border: 1px solid rgba(22, 163, 74, 0.7);
    }

    .doc-section {
      margin-bottom: 0.5rem;
    }

    .doc-section-title {
      font-weight: 600;
      margin-bottom: 0.12rem;
      color: #e5e7eb;
    }

    .doc-section-body {
      color: var(--text-soft);
    }

    .footer-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.45rem;
      font-size: 0.75rem;
      color: var(--text-soft);
      gap: 0.6rem;
      flex-wrap: wrap;
    }

    textarea {
      width: 100%;
      height: 130px;
      resize: none;
      background: #020617;
      color: #e5e7eb;
      border-radius: 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 0.4rem 0.5rem;
      font-size: 0.78rem;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- Top bar -->
  <header class="topbar">
    <div class="brand">
      <div class="brand-logo"></div>
      <div class="brand-title">
        <span>RIVER BASIN SCENARIO AI</span>
        <span>流域治水 説明シナリオスタジオ</span>
      </div>
    </div>
    <div class="topbar-right">
      <div class="role-toggle">
        <button class="role-btn active" id="userRoleBtn" type="button">利用者ビュー</button>
        <button class="role-btn" id="adminRoleBtn" type="button">管理者コンソール</button>
      </div>
      <div class="badge">対象水系：●●川水系（PoC）</div>
    </div>
  </header>

  <main class="app-shell">
    <!-- USER SIDEBAR -->
    <aside class="sidebar" id="userSidebar">
      <div class="sidebar-header">
        <h2>利用者フロー – 説明シナリオ作成</h2>
        <p>河川管理者などの利用者が、データには触れずにシナリオ作成だけを行うビューです。</p>
      </div>
      <ul class="step-list" id="userStepList">
        <li class="step-item active" data-step="u1">
          <div class="step-index">1</div>
          <div>
            <div class="step-title">対象者を選ぶ</div>
            <div class="step-caption">住民（大人）、こども、企業、専門家など</div>
          </div>
        </li>
        <li class="step-item" data-step="u2">
          <div class="step-index">2</div>
          <div>
            <div class="step-title">資料に基づいて質問</div>
            <div class="step-caption">公開資料に基づくQ&A（RAG）</div>
          </div>
        </li>
        <li class="step-item" data-step="u3">
          <div class="step-index">3</div>
          <div>
            <div class="step-title">説明シナリオを生成</div>
            <div class="step-caption">構成案と時間配分</div>
          </div>
        </li>
        <li class="step-item" data-step="u4">
          <div class="step-index">4</div>
          <div>
            <div class="step-title">チャットで微調整</div>
            <div class="step-caption">わかりやすさ・専門性の調整</div>
          </div>
        </li>
        <li class="step-item" data-step="u5">
          <div class="step-index">5</div>
          <div>
            <div class="step-title">編集・エクスポート</div>
            <div class="step-caption">スライド・台本・配布資料に出力</div>
          </div>
        </li>
      </ul>
      <div class="sidebar-footer">
        <b>利用者ビュー：</b>
        ファイルアップロードやインデックス設定には一切触れられません。
        できるのは「質問する」「シナリオを作る・編集する」「資料として出力する」だけです。
      </div>
    </aside>

    <!-- ADMIN SIDEBAR -->
    <aside class="sidebar hidden" id="adminSidebar">
      <div class="sidebar-header">
        <h2>管理者フロー – ナレッジ・RAG管理</h2>
        <p>管理者が文書登録、インデックス作成、更新スケジュール、監視を行うビューです。</p>
      </div>
      <ul class="step-list" id="adminStepList">
        <li class="step-item active" data-step="a1">
          <div class="step-index">1</div>
          <div>
            <div class="step-title">文書の登録・管理</div>
            <div class="step-caption">方針・計画・想定浸水区域図など</div>
          </div>
        </li>
        <li class="step-item" data-step="a2">
          <div class="step-index">2</div>
          <div>
            <div class="step-title">インデックス作成・RAG</div>
            <div class="step-caption">分割・ベクトル化・公開</div>
          </div>
        </li>
        <li class="step-item" data-step="a3">
          <div class="step-index">3</div>
          <div>
            <div class="step-title">データソースと自動更新</div>
            <div class="step-caption">Web/RPAでの更新ルール</div>
          </div>
        </li>
        <li class="step-item" data-step="a4">
          <div class="step-index">4</div>
          <div>
            <div class="step-title">監視・権限管理</div>
            <div class="step-caption">利用状況とロールコントロール</div>
          </div>
        </li>
      </ul>
      <div class="sidebar-footer">
        <b>管理者ビュー：</b>
        文書のバージョン管理、インデックス設定、Web/RPAによる自動更新、権限管理などを行います。
        シナリオ本文の編集はここからは行いません（利用者側で実施）。
      </div>
    </aside>

    <!-- USER MAIN -->
    <section class="main" id="userMain">
      <div class="main-header">
        <div class="main-header-left">
          <h1>利用者スタジオ – 説明シナリオを作成</h1>
          <p>対象者や時間を指定すると、公表資料に基づいた説明シナリオ案を自動生成します。</p>
          <div class="chip-row">
            <span class="chip">ロール：河川管理者・説明担当</span>
            <span class="chip">LLM：GPT-4.1（RAG）</span>
            <span class="chip">アップロード機能なし</span>
          </div>
        </div>
        <div>
          <button class="btn secondary" type="button">保存済みシナリオを開く</button>
          <button class="btn" type="button" style="margin-left:0.35rem;">新しいシナリオ</button>
        </div>
      </div>

      <div class="panel-container">
        <div class="panel-header">
          <h2 id="userPanelTitle">1 · 対象者を選ぶ</h2>
          <p id="userPanelSubtitle">誰に説明するかを選ぶと、言葉遣いや構成が自動で調整されます。</p>
        </div>

        <!-- U1: choose audience -->
        <div class="panel two-col active" data-user-panel="u1">
          <div class="card">
            <div class="card-header">
              <h3>対象者・セッション設定</h3>
              <span>トーンや難易度、時間配分に反映されます。</span>
            </div>
            <div class="card-body">
              <div style="display:grid;gap:0.5rem;">
                <label>
                  対象者の種類<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>住民（大人）</option>
                    <option>子ども（小学生想定）</option>
                    <option>企業・物流事業者</option>
                    <option>大学・専門家</option>
                  </select>
                </label>
                <label>
                  説明時間<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>10〜15分</option>
                    <option>5〜10分</option>
                    <option>20〜30分</option>
                  </select>
                </label>
                <label>
                  説明スタイル<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>やさしく・身近な言葉で</option>
                    <option>技術的・データ重視</option>
                    <option>事例を交えたストーリー型</option>
                  </select>
                </label>
              </div>
              <div style="margin-top:0.6rem;text-align:right;">
                <button class="btn" type="button">次へ：資料に基づいて質問</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>シナリオ概要（プレビュー）</h3>
              <span>設定を変えると随時更新されます。</span>
            </div>
            <div class="card-body">
              <div class="doc-preview">
                <div class="doc-header">
                  <div class="doc-title">住民（大人）· 15分 · ●●川</div>
                  <span class="doc-tag">まだ未生成</span>
                </div>
                <p style="margin:0;font-size:0.78rem;color:var(--text-soft);">
                  対象者と時間を確定すると、AI が以下を提案します：
                </p>
                <ul style="margin:0.4rem 0 0;padding-left:1.1rem;font-size:0.78rem;">
                  <li>5〜6章程度の構成（過去の水害・現在のリスク・対策・住民ができること 等）</li>
                  <li>各章の時間配分</li>
                  <li>洪水浸水想定区域図や河川整備方針に整合した要点</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- U2: chat with docs -->
        <div class="panel two-col" data-user-panel="u2">
          <div class="card">
            <div class="card-header">
              <h3>資料に基づくチャット</h3>
              <span>登録済みの公表資料だけを根拠に回答します。</span>
            </div>
            <div class="card-body">
              <div class="chat-window">
                <div class="chat-message user">
                  直近の大きな洪水で、●●橋付近は最大でどのくらい浸水しましたか？
                  <div class="chat-meta">あなた · 住民向けセッション</div>
                </div>
                <div class="chat-message ai">
                  R1 年の豪雨時には、●●橋付近の低い街区で最大およそ
                  <b>1.8m</b> 程度の浸水が確認されています。
                  これは被災後調査報告書（12〜15 ページ）の結果に基づきます。
                  <div class="chat-meta">AI · 根拠：被災後調査報告書・浸水実績図（R1）など</div>
                </div>
              </div>
              <div class="chat-input-row">
                <input class="chat-input" placeholder="過去の水害、現在のリスク、整備内容などを質問…" />
                <button class="btn secondary" type="button">送信</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>質問テンプレート</h3>
              <span>「何を聞けばいいか分からない」を補助します。</span>
            </div>
            <div class="card-body">
              <div class="pill-row">
                <span class="pill">「想定最大規模の洪水」をやさしく説明して</span>
                <span class="pill">前回の大きな洪水と今の違いは？</span>
                <span class="pill">高齢者が特に気をつける点は？</span>
                <span class="pill">子ども向けに言い換えて</span>
              </div>
              <div style="margin-top:0.7rem;">
                <button class="btn" type="button">次へ：シナリオ生成</button>
              </div>
            </div>
          </div>
        </div>

        <!-- U3: generate scenario -->
        <div class="panel two-col" data-user-panel="u3">
          <div class="card">
            <div class="card-header">
              <h3>シナリオ構成案</h3>
              <span>資料＋あなたの質問内容から自動生成します。</span>
            </div>
            <div class="card-body">
              <div class="doc-preview">
                <div class="doc-header">
                  <div class="doc-title">シナリオ v1 – 住民（大人）向け</div>
                  <span class="doc-tag">AI生成</span>
                </div>
                <div class="doc-section">
                  <div class="doc-section-title">1. 導入（1分）</div>
                  <div class="doc-section-body">あいさつ、本日の目的と流れ。</div>
                </div>
                <div class="doc-section">
                  <div class="doc-section-title">2. この地域の過去の水害（3分）</div>
                  <div class="doc-section-body">R1 年出水の概要、写真、簡単な数字。</div>
                </div>
                <div class="doc-section">
                  <div class="doc-section-title">3. これから起こりうる浸水（4分）</div>
                  <div class="doc-section-body">●●橋周辺などの想定浸水深を、地図と合わせて説明。</div>
                </div>
                <div class="doc-section">
                  <div class="doc-section-title">4. 行われている対策（4分）</div>
                  <div class="doc-section-body">流域治水プロジェクト2.0 の概要と進捗。</div>
                </div>
                <div class="doc-section">
                  <div class="doc-section-title">5. 家庭でできる備え（3分）</div>
                  <div class="doc-section-body">ハザードマップの確認、避難行動、家族で話すポイント。</div>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>シナリオ操作</h3>
              <span>事実は固定し、見せ方だけ変えられます。</span>
            </div>
            <div class="card-body">
              <div class="pill-row">
                <span class="pill">全体をもう少し短くする</span>
                <span class="pill">「住民ができること」を増やす</span>
                <span class="pill">AR/VR デモの時間を追加</span>
              </div>
              <div style="margin-top:0.7rem;">
                <button class="btn" type="button">次へ：チャットで微調整</button>
              </div>
            </div>
          </div>
        </div>

        <!-- U4: refine by chat -->
        <div class="panel two-col" data-user-panel="u4">
          <div class="card">
            <div class="card-header">
              <h3>シナリオ調整チャット</h3>
              <span>自然な日本語で「こうしてほしい」と伝えます。</span>
            </div>
            <div class="card-body">
              <div class="chat-window-large">
                <div class="chat-message user">
                  第3章の説明を、高齢の住民の方にも分かりやすい表現にして。専門用語はできるだけ使わないでください。
                  <div class="chat-meta">あなた</div>
                </div>
                <div class="chat-message ai">
                  <p style="margin-top:0;">
                    まず、この地域で想定されている水深が「1〜2メートル」ということを、日常のイメージに置き換えて説明します。
                    例えば「車がほぼ隠れてしまい、1階の窓の高さ近くまで水が来る高さ」といった表現にします。
                    <span class="citation">[河川整備基本方針 p.12]</span>
                  </p>
                  <p>
                    次に、●●橋付近など特に低い場所では、さらに深い浸水が想定されていることを補足します。
                    「3メートル近くまで達するところもあり、その場合は車での移動がかえって危険になる」というように、
                    具体的な行動のイメージとセットで伝えます。
                    <span class="citation">[洪水浸水想定区域図（想定最大規模）]</span>
                  </p>
                  <p>
                    最後に、「早めに歩いて避難する」「近くの高い建物に移動する」など、
                    高齢の方でも取りやすい行動を挙げて締めくくります。
                    難しい用語は避け、「普段の生活の中でどう動けばよいか」を中心にまとめます。
                    <span class="citation">[自分事化検討会資料 第2回]</span>
                  </p>

                  <div class="refs-box">
                    <div class="refs-title">参考文献（自動抽出）</div>
                    <ul class="refs-list">
                      <li>河川整備基本方針（●●川水系） p.12–15</li>
                      <li>洪水浸水想定区域図（想定最大規模）</li>
                      <li>流域治水 自分事化検討会 資料 第2回</li>
                    </ul>
                  </div>

                </div>

              </div>
              <div class="chat-input-row">
                <input class="chat-input" placeholder="やさしく・短く・専門的になど、調整したいことを入力…" />
                <button class="btn secondary" type="button">適用</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>対象変更（バリエーション）</h3>
              <span>同じ構成で、言葉だけ変えたパターンを作成。</span>
            </div>
            <div class="card-body">
              <div class="pill-row">
                <span class="pill">子ども（10分）向けに変換</span>
                <span class="pill">企業のBCP説明会用に変換</span>
                <span class="pill">専門家向け技術資料を追加</span>
              </div>
            </div>
          </div>
        </div>

        <!-- U5: edit & export -->
        <div class="panel two-col" data-user-panel="u5">
          <div class="card">
            <div class="card-header">
              <h3>手動編集</h3>
              <span>最終的な人間によるチェック・修正。</span>
            </div>
            <div class="card-body">
              <div class="doc-preview">
                <div class="doc-header">
                  <div class="doc-title">第3章 – 編集後テキスト</div>
                  <span class="doc-tag">人の目で確認</span>
                </div>
                <textarea>とても大きな洪水が起きた場合、このあたりの地域では水の深さが1〜2メートルになるおそれがあります。これは、車がほぼ隠れてしまい、1階の窓の高さ近くまで水が来るイメージです。

●●橋に近い、特に低い場所では、3メートル近くまで達するところもあります。そのような状況になると、車での避難はかえって危険になる可能性があります。早めに歩いて移動する、もしくは近くの高い建物に避難することが大切です。</textarea>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>エクスポート</h3>
              <span>利用者が最終的に受け取るアウトプット。</span>
            </div>
            <div class="card-body">
              <div class="doc-preview">
                <div class="doc-header">
                  <div class="doc-title">出力パッケージ</div>
                  <span class="doc-tag">準備完了</span>
                </div>
                <ul style="margin:0;padding-left:1.1rem;font-size:0.78rem;">
                  <li>PowerPoint スライド（12枚想定）</li>
                  <li>説明用台本（PDF）</li>
                  <li>住民向け1枚配布資料</li>
                  <li>シナリオ JSON（再利用・社内共有用）</li>
                </ul>
                <div class="footer-bar">
                  <div>シナリオID：<code>●●-residents-2024-11-001</code></div>
                  <div>
                    <button class="btn secondary" type="button">PPTX をプレビュー</button>
                    <button class="btn" type="button" style="margin-left:0.3rem;">一括エクスポート</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- ADMIN MAIN -->
    <section class="main hidden" id="adminMain">
      <div class="main-header">
        <div class="main-header-left">
          <h1>管理者コンソール – ナレッジと RAG を管理</h1>
          <p>文書の登録・バージョン管理、インデックス作成、Web/RPA 更新、権限管理を行います。</p>
          <div class="chip-row">
            <span class="chip">ロール：システム管理者・エンジニア</span>
            <span class="chip">Azure AI Search · Blob · RPA</span>
            <span class="chip">全利用者に影響</span>
          </div>
        </div>
        <div>
          <button class="btn secondary" type="button">ログを表示</button>
          <button class="btn" type="button" style="margin-left:0.35rem;">新しい水系を登録</button>
        </div>
      </div>

      <div class="panel-container">
        <div class="panel-header">
          <h2 id="adminPanelTitle">1 · 文書の登録・管理</h2>
          <p id="adminPanelSubtitle">水系ごとに公表資料を登録し、承認済みのみが RAG の対象となるよう管理します。</p>
        </div>

        <!-- A1: upload & manage -->
        <div class="panel two-col active" data-admin-panel="a1">
          <div class="card">
            <div class="card-header">
              <h3>文書アップロード</h3>
              <span>管理者のみが公式ナレッジベースを更新できます。</span>
            </div>
            <div class="card-body">
              <div class="upload-drop">
                <strong>新規／改訂版のファイルをここにドラッグ＆ドロップ</strong>
                <small>河川整備基本方針・河川整備計画・流域治水プロジェクト・浸水想定区域図など</small>
                <div style="margin-top:0.55rem;">
                  <button class="btn secondary" type="button">+ ファイルを選択</button>
                </div>
              </div>
              <div class="file-list">
                <div class="file-row">
                  <div>
                    <div class="file-name">●●川水系_河川整備基本方針_v3.pdf</div>
                    <div class="file-meta">状態：承認済み・利用中 · 184ページ</div>
                  </div>
                  <div class="file-meta">v3</div>
                </div>
                <div class="file-row">
                  <div>
                    <div class="file-name">●●川水系_河川整備基本方針_v2.pdf</div>
                    <div class="file-meta">状態：廃止・参照用に保存</div>
                  </div>
                  <div class="file-meta">v2</div>
                </div>
                <div class="file-row">
                  <div>
                    <div class="file-name">●●川水系_流域治水プロジェクト2_0_概要.pdf</div>
                    <div class="file-meta">状態：承認済み · 再インデックス待ち</div>
                  </div>
                  <div class="file-meta">v1</div>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>水系・コレクション</h3>
              <span>複数水系をまとめて管理できます。</span>
            </div>
            <div class="card-body">
              <div style="display:grid;gap:0.5rem;">
                <label>
                  対象水系<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>●●川水系</option>
                    <option>△△川水系</option>
                    <option>□□川水系</option>
                  </select>
                </label>
                <label>
                  コレクション<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>方針・計画類</option>
                    <option>浸水想定区域図</option>
                    <option>検討会・ワーキング資料</option>
                  </select>
                </label>
              </div>
              <div style="margin-top:0.7rem;text-align:right;">
                <button class="btn" type="button">次へ：インデックス・RAG</button>
              </div>
            </div>
          </div>
        </div>

        <!-- A2: indexing & RAG -->
        <div class="panel two-col" data-admin-panel="a2">
          <div class="card">
            <div class="card-header">
              <h3>インデックス状況</h3>
              <span>分割・埋め込み・公開の進行状況。</span>
            </div>
            <div class="card-body">
              <div class="status-pill">
                <span class="status-dot"></span>
                <span>インデックス再構築中 · 72% 完了</span>
              </div>
              <div class="progress-bar">
                <div class="progress-bar-inner"></div>
              </div>
              <div class="log">
                <div class="log-line">
                  <span class="log-time">12:10:03</span>
                  <span class="log-msg">[AI Search] インデックス basin_●●_pdf_index を再構築中</span>
                </div>
                <div class="log-line">
                  <span class="log-time">12:10:15</span>
                  <span class="log-msg">[ETL] 基本方針 v3 から 1,236 チャンクを作成</span>
                </div>
                <div class="log-line">
                  <span class="log-time">12:10:26</span>
                  <span class="log-msg">[Embedding] text-embedding-3-large: 52,100 トークン</span>
                </div>
                <div class="log-line">
                  <span class="log-time">12:10:39</span>
                  <span class="log-msg">[Cleanup] 基本方針 v2 を retired に設定</span>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>RAG 設定</h3>
              <span>エンジニア向けの技術パラメータ（利用者からは隠蔽）。</span>
            </div>
            <div class="card-body">
              <div style="display:grid;gap:0.5rem;font-size:0.78rem;">
                <label>
                  取得するチャンク数（Top K）<br />
                  <input type="number" value="5"
                    style="width:100%;margin-top:0.18rem;padding:0.28rem 0.5rem;border-radius:0.6rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                </label>
                <label>
                  厳格さ（Strictness）<br />
                  <input type="number" value="3" min="1" max="5"
                    style="width:100%;margin-top:0.18rem;padding:0.28rem 0.5rem;border-radius:0.6rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                </label>
                <label>
                  Web 検索の使い方<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>RAG でヒットしない時のみ併用</option>
                    <option>常に RAG + Web を併用</option>
                    <option>Web 検索は使用しない</option>
                  </select>
                </label>
              </div>
              <div style="margin-top:0.7rem;">
                <button class="btn" type="button">この設定でインデックスを更新</button>
              </div>
            </div>
          </div>
        </div>

        <!-- A3: data sources & schedules -->
        <div class="panel two-col" data-admin-panel="a3">
          <div class="card">
            <div class="card-header">
              <h3>データソース</h3>
              <span>新しい文書をどこから取り込むか。</span>
            </div>
            <div class="card-body">
              <div class="doc-preview">
                <div class="doc-header">
                  <div class="doc-title">ソース一覧</div>
                  <span class="doc-tag">RPA / API</span>
                </div>
                <ul style="margin:0;padding-left:1.1rem;font-size:0.78rem;">
                  <li>国交省の流域治水関連ポータル（RSS + HTMLスクレイピング）</li>
                  <li>自治体の水害・防災情報ページ</li>
                  <li>社内共有フォルダ（検討会資料 等）</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>更新スケジュール</h3>
              <span>どの頻度で取得・再インデックスするか。</span>
            </div>
            <div class="card-body">
              <div style="display:grid;gap:0.5rem;font-size:0.78rem;">
                <label>
                  Web クロール頻度<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>週1回</option>
                    <option>毎日</option>
                    <option>月1回</option>
                  </select>
                </label>
                <label>
                  自動再インデックス<br />
                  <select
                    style="width:100%;margin-top:0.18rem;padding:0.3rem 0.5rem;border-radius:0.65rem;border:1px solid rgba(148,163,184,0.7);background:#020617;color:#e5e7eb;">
                    <option>新しい文書／バージョン検知時に自動実行</option>
                    <option>管理者が手動実行のみ</option>
                  </select>
                </label>
              </div>
              <div style="margin-top:0.7rem;">
                <button class="btn" type="button">スケジュールを保存</button>
              </div>
            </div>
          </div>
        </div>

        <!-- A4: monitoring & access -->
        <div class="panel two-col" data-admin-panel="a4">
          <div class="card">
            <div class="card-header">
              <h3>システムヘルス</h3>
              <span>管理者向けのダッシュボードイメージ。</span>
            </div>
            <div class="card-body">
              <div class="doc-preview">
                <div class="doc-header">
                  <div class="doc-title">●●川水系の状態</div>
                  <span class="doc-tag">問題なし</span>
                </div>
                <ul style="margin:0;padding-left:1.1rem;font-size:0.78rem;">
                  <li>RAG インデックス：正常 · 最終更新 2 時間前</li>
                  <li>Web クロール：3 日前に実施 · 新規 1 ファイル</li>
                  <li>LLM 利用状況：1 週間で 132 セッション</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>アクセス権・ロール</h3>
              <span>誰が何をできるか。</span>
            </div>
            <div class="card-body">
              <ul style="margin:0;padding-left:1.1rem;font-size:0.78rem;">
                <li><b>利用者</b> – チャット、シナリオ生成・編集・エクスポートが可能。</li>
                <li><b>管理者</b> – 文書登録、インデックス設定、更新スケジュール、権限管理が可能。</li>
                <li><b>閲覧者</b> – 共有されたシナリオの閲覧のみ。</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <script>
    // Role toggle
    const userRoleBtn = document.getElementById("userRoleBtn");
    const adminRoleBtn = document.getElementById("adminRoleBtn");
    const userSidebar = document.getElementById("userSidebar");
    const adminSidebar = document.getElementById("adminSidebar");
    const userMain = document.getElementById("userMain");
    const adminMain = document.getElementById("adminMain");

    userRoleBtn.addEventListener("click", () => {
      userRoleBtn.classList.add("active");
      adminRoleBtn.classList.remove("active");
      userSidebar.classList.remove("hidden");
      userMain.classList.remove("hidden");
      adminSidebar.classList.add("hidden");
      adminMain.classList.add("hidden");
    });

    adminRoleBtn.addEventListener("click", () => {
      adminRoleBtn.classList.add("active");
      userRoleBtn.classList.remove("active");
      adminSidebar.classList.remove("hidden");
      adminMain.classList.remove("hidden");
      userSidebar.classList.add("hidden");
      userMain.classList.add("hidden");
    });

    // User steps
    const userSteps = document.querySelectorAll("#userStepList .step-item");
    const userPanels = document.querySelectorAll("[data-user-panel]");
    const userTitles = {
      u1: ["1 · 対象者を選ぶ", "誰に説明するかを選ぶと、言葉遣いや構成が自動で調整されます。"],
      u2: ["2 · 資料に基づいて質問", "公表資料・地図を根拠とした Q&A を行います。"],
      u3: ["3 · 説明シナリオを生成", "説明会の構成と時間配分を自動生成します。"],
      u4: ["4 · チャットで微調整", "自然な日本語でトーンや詳細レベルを調整します。"],
      u5: ["5 · 編集・エクスポート", "最終確認のうえ、スライドや台本として出力します。"]
    };
    const userPanelTitle = document.getElementById("userPanelTitle");
    const userPanelSubtitle = document.getElementById("userPanelSubtitle");

    userSteps.forEach(step => {
      step.addEventListener("click", () => {
        const id = step.getAttribute("data-step");
        userSteps.forEach(s => s.classList.remove("active"));
        step.classList.add("active");
        userPanels.forEach(p => {
          p.classList.toggle("active", p.getAttribute("data-user-panel") === id);
        });
        userPanelTitle.textContent = userTitles[id][0];
        userPanelSubtitle.textContent = userTitles[id][1];
      });
    });

    // Admin steps
    const adminSteps = document.querySelectorAll("#adminStepList .step-item");
    const adminPanels = document.querySelectorAll("[data-admin-panel]");
    const adminTitles = {
      a1: ["1 · 文書の登録・管理", "水系ごとに公表資料を登録し、承認済みのみを RAG の対象にします。"],
      a2: ["2 · インデックス作成・RAG", "分割・埋め込み・検索の挙動を制御します。"],
      a3: ["3 · データソースと自動更新", "新しい文書の取得元と更新頻度を設定します。"],
      a4: ["4 · 監視・権限管理", "システム状態とロール／権限を管理します。"]
    };
    const adminPanelTitle = document.getElementById("adminPanelTitle");
    const adminPanelSubtitle = document.getElementById("adminPanelSubtitle");

    adminSteps.forEach(step => {
      step.addEventListener("click", () => {
        const id = step.getAttribute("data-step");
        adminSteps.forEach(s => s.classList.remove("active"));
        step.classList.add("active");
        adminPanels.forEach(p => {
          p.classList.toggle("active", p.getAttribute("data-admin-panel") === id);
        });
        adminPanelTitle.textContent = adminTitles[id][0];
        adminPanelSubtitle.textContent = adminTitles[id][1];
      });
    });
  </script>
</body>

</html>